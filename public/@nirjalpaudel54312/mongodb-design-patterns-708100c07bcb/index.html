<!doctype html>































<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="en-us"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Eat the frog: MongoDB Design Patterns - My New Hugo Site</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="Here are some of the few design patterns that you can use to better your MongoDB schema, so you‚Äôll keep your team happy and yourself happier.
MongoDB is a flexible schema based document database. Flexibility was something that we were craving after many years with SQL. Flexibility is so fun to code and enjoy until your application code is suffering from ‚ÄúWhat was the schema again?‚Äù problem. MongoDB follows document based design principle for modelling things." />
  <meta name="author" content="My New Hugo Site" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://localhost:1313/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://localhost:1313/theme.png" />

  
  
  
  
  

  
  
  

  
  
  <script
    defer
    src="http://localhost:1313/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.126.1">

  
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://localhost:1313/"
      >My New Hugo Site</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Eat the frog: MongoDB Design Patterns</h1>

    
  </header>

  <section><p>Here are some of the few design patterns that you can use to better your MongoDB schema, so you‚Äôll keep your team happy and yourself happier.</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/0__RjTdnRANRE0XW2Rn.jpg" alt=""></p>
<p>MongoDB is a flexible schema based document database. Flexibility was something that we were craving after many years with SQL. Flexibility is so fun to code and enjoy until your application code is suffering from ‚ÄúWhat was the schema again?‚Äù problem. MongoDB follows document based design principle for modelling things. You can insert as many objects/arrays in MongoDB as long as you don‚Äôt hit the limit of 16mb.¬†<br>
So, <em>chances of you never discovering the problem until it is very late is high.</em></p>
<p>Here are some of the design patterns you can model your schema with</p>
<ol>
<li><strong>Schema versioning Pattern:</strong></li>
</ol>
<p>In MongoDB schema, or any NoSQL based DB, schema versioning is a method in which we add a field representing the version of schema that the document obeys. Schema will be read by the application code, and a logic must be in place for handling every possible schema version value.</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/0__Cv4uXguspMGLfnMN.jpg" alt=""></p>
<p>Schema version has its own pros and cons.</p>
<p>Pros:</p>
<ul>
<li>Easier to handle changes</li>
<li>The flexibility of your application grows.</li>
<li>Easier to debug and track</li>
</ul>
<p>Cons:</p>
<ul>
<li>Added complexity in the application layer.</li>
<li>The database can grow inconsistent over time.</li>
<li>Database may be harder to navigate without application logic making it logically coupled with each other.</li>
</ul>
<p>2. Computed Pattern:</p>
<p>Have you ever wondered, how can YouTube get the real time total views of a video?</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/1__1Wk5YcjMLDmpnrElHzV4eQ.png" alt=""></p>
<p>The video above has 1.3B views, but if you were to count that in any DB using</p>
<p>db.getCollection(&ldquo;video-views&rdquo;).find({}).count();</p>
<p>The query above would take ages to count the total views of the video. But on YouTube you can see the total view in an instant right. So let me introduce you to the computed value pattern. Instead of counting the video views every time, you introduce a field in video, say view which will get updated every time when a user views the video and now instead of counting the total views, you can present users with that value.</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/1__3VZvZpH8p89PYUJw__1fABQ.png" alt=""></p>
<p>The new documents would be something like this, and your application service should increment the value of views every time someone views the video.</p>
<p>{<br>
&ldquo;title&rdquo;: &ldquo;Rick Astley - Never Gonna Give You Up (Official Music Video)&rdquo;,<br>
&ldquo;description&rdquo;: &ldquo;1987 pop hit, famously used in internet &lsquo;Rickrolling&rsquo; meme&rdquo;,<br>
&ldquo;videoId&rdquo;: &ldquo;dQw4w9WgXcQ&rdquo;,<br>
&ldquo;views&rdquo;: 217383786<br>
}</p>
<p>Pros:</p>
<ul>
<li>Real time data is fetched every time</li>
<li>This is effective as the computed pattern only does a fraction of work for same result</li>
</ul>
<p>Cons:</p>
<ul>
<li>It may be harder to maintain, if you are computing the values in very short intervals.</li>
<li>The data may be incorrect if transactions are not in place</li>
</ul>
<p>3. Subset Pattern:</p>
<p>Subset pattern in MongoDB is a pattern in we store a subset of field of a document in a foreign collection. It can be thought of as materialized view for MongoDB. For a big document, say user as</p>
<p>{<br>
&ldquo;_id&rdquo;: ObjectId(&ldquo;6155e5b5c3e30c0410c07e84&rdquo;),<br>
&ldquo;username&rdquo;: &ldquo;johndoe&rdquo;,<br>
&ldquo;email&rdquo;: &ldquo;<a href="mailto:john.doe@example.com">john.doe@example.com</a>&rdquo;,<br>
&ldquo;password&rdquo;: &ldquo;$2a$12$R1..K94OiVJ.gNwINZfNkuNpJcoCJErjy.NxJmp/9cGJbEjK2rJ4S&rdquo;,<br>
&ldquo;profile&rdquo;: {<br>
&ldquo;firstName&rdquo;: &ldquo;John&rdquo;,<br>
&ldquo;lastName&rdquo;: &ldquo;Doe&rdquo;,<br>
&ldquo;birthdate&rdquo;: ISODate(&ldquo;1980-01-01T00:00:00Z&rdquo;),<br>
&ldquo;gender&rdquo;: &ldquo;male&rdquo;,<br>
&ldquo;address&rdquo;: {<br>
&ldquo;street&rdquo;: &ldquo;123 Main St&rdquo;,<br>
&ldquo;city&rdquo;: &ldquo;Anytown&rdquo;,<br>
&ldquo;state&rdquo;: &ldquo;CA&rdquo;,<br>
&ldquo;zip&rdquo;: &ldquo;12345&rdquo;<br>
},<br>
&ldquo;phoneNumbers&rdquo;: {<br>
&ldquo;home&rdquo;: &ldquo;555-1234&rdquo;,<br>
&ldquo;work&rdquo;: &ldquo;555-5678&rdquo;,<br>
&ldquo;mobile&rdquo;: &ldquo;555-9012&rdquo;<br>
},<br>
&ldquo;education&rdquo;: [<br>
{<br>
&ldquo;degree&rdquo;: &ldquo;Bachelor of Science&rdquo;,<br>
&ldquo;major&rdquo;: &ldquo;Computer Science&rdquo;,<br>
&ldquo;university&rdquo;: &ldquo;University of California, Los Angeles&rdquo;,<br>
&ldquo;graduationYear&rdquo;: 2002<br>
},<br>
{<br>
&ldquo;degree&rdquo;: &ldquo;Master of Business Administration&rdquo;,<br>
&ldquo;major&rdquo;: &ldquo;Finance&rdquo;,<br>
&ldquo;university&rdquo;: &ldquo;Stanford University&rdquo;,<br>
&ldquo;graduationYear&rdquo;: 2006<br>
}<br>
],<br>
&ldquo;workHistory&rdquo;: [<br>
{<br>
&ldquo;company&rdquo;: &ldquo;Acme Corporation&rdquo;,<br>
&ldquo;position&rdquo;: &ldquo;Software Engineer&rdquo;,<br>
&ldquo;startDate&rdquo;: ISODate(&ldquo;2002-01-01T00:00:00Z&rdquo;),<br>
&ldquo;endDate&rdquo;: ISODate(&ldquo;2005-12-31T00:00:00Z&rdquo;)<br>
},<br>
{<br>
&ldquo;company&rdquo;: &ldquo;Widgets, Inc.&rdquo;,<br>
&ldquo;position&rdquo;: &ldquo;Product Manager&rdquo;,<br>
&ldquo;startDate&rdquo;: ISODate(&ldquo;2006-01-01T00:00:00Z&rdquo;),<br>
&ldquo;endDate&rdquo;: ISODate(&ldquo;2010-12-31T00:00:00Z&rdquo;)<br>
},<br>
{<br>
&ldquo;company&rdquo;: &ldquo;XYZ Corp.&rdquo;,<br>
&ldquo;position&rdquo;: &ldquo;Director of Marketing&rdquo;,<br>
&ldquo;startDate&rdquo;: ISODate(&ldquo;2011-01-01T00:00:00Z&rdquo;),<br>
&ldquo;endDate&rdquo;: null<br>
}<br>
],<br>
&ldquo;interests&rdquo;: [<br>
&ldquo;hiking&rdquo;,<br>
&ldquo;reading&rdquo;,<br>
&ldquo;traveling&rdquo;,<br>
&ldquo;playing guitar&rdquo;<br>
]<br>
},<br>
&ldquo;preferences&rdquo;: {<br>
&ldquo;language&rdquo;: &ldquo;en&rdquo;,<br>
&ldquo;theme&rdquo;: &ldquo;light&rdquo;,<br>
&ldquo;timezone&rdquo;: &ldquo;America/Los_Angeles&rdquo;<br>
},<br>
&ldquo;notifications&rdquo;: [<br>
{<br>
&ldquo;type&rdquo;: &ldquo;email&rdquo;,<br>
&ldquo;frequency&rdquo;: &ldquo;daily&rdquo;<br>
},<br>
{<br>
&ldquo;type&rdquo;: &ldquo;sms&rdquo;,<br>
&ldquo;frequency&rdquo;: &ldquo;weekly&rdquo;<br>
}<br>
],<br>
&ldquo;createdAt&rdquo;: ISODate(&ldquo;2021-09-30T10:15:01Z&rdquo;),<br>
&ldquo;updatedAt&rdquo;: ISODate(&ldquo;2022-10-01T14:30:05Z&rdquo;)<br>
}</p>
<p>We can store a smaller, collection, say username, which holds a subset of fields from the user document which may look like this.</p>
<p>{<br>
&ldquo;_id&rdquo;: ObjectId(&ldquo;605edb98fbf3d639d3cf6c8f&rdquo;),<br>
&ldquo;name&rdquo;: &ldquo;Jane Doe&rdquo;,<br>
&ldquo;email&rdquo;: &ldquo;<a href="mailto:jane.doe@example.com">jane.doe@example.com</a>&rdquo;<br>
}</p>
<p>Note: We can achieve the same result using projection operation in MongoDB or $project pipeline in MongoDB aggregation. Now instead of using the user collection for reading the value, we can use username collection.</p>
<p>Pros:</p>
<ul>
<li>Effective memory management</li>
<li>Shorter disk access time</li>
</ul>
<p>Cons:</p>
<ul>
<li>In case of transaction not being used, the collections may become inconsistent</li>
<li>Additional trips to the DB in case of create, update or delete operations</li>
</ul>
<p>4. Bucket Pattern:</p>
<blockquote>
<p>In computer science, a bucket refers to a logical collection that holds similar items together.</p>
</blockquote>
<p>For a log based application that has write heavy usage, <em>the application receives high amount of write operations as compared to read operations.</em> This type of access pattern can be found in a log application like user tracking system, gaming system, etc. The question of how would you divide the given written data is answered by the bucket pattern.</p>
<p>Let‚Äôs say that you are tracking temperature of a room using some devices and storing it in a database. Then a bucket based division can divide the written data records as</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/1__n69B281qDhy90Ifad1Amew.png" alt=""></p>
<p>We can run analytics based on the bucket data, we can also add bucket pattern with computed data pattern to accommodate statistical data for our simplicity, the newer version of documents would look as</p>
<p>{<br>
device_id: &ldquo;device1&rdquo;,<br>
type: &ldquo;2A&rdquo;,<br>
date: ISODate(&ldquo;2022-04-01T00:00:00Z&rdquo;),<br>
temp: [20.5, 21.3, 22.1, 20.8, 21.7],<br>
mean_temperature: 21.28,<br>
std_temperature: 0.72<br>
},<br>
{<br>
device_id: &ldquo;device1&rdquo;,<br>
type: &ldquo;2A&rdquo;,<br>
date: ISODate(&ldquo;2022-04-01T01:00:00Z&rdquo;),<br>
temp: [21.1, 20.9, 21.5, 22.3, 20.4],<br>
mean_temperature: 21.24,<br>
std_temperature: 0.69<br>
}</p>
<p>Pros:</p>
<ol>
<li>Good for IOT implementations</li>
<li>Improves querying speed with indexes</li>
<li>Great for time series data</li>
</ol>
<p>Cons:</p>
<ol>
<li>Increased storage requirements</li>
<li>Increased complexity</li>
<li>Proper bucket selection must be done to prevent empty buckets</li>
</ol>
<p>There are few more design pattern in MongoDB like the outlier pattern, Polymorphic pattern for your use cases. Each one of them have their pros and cons. <a href="https://www.mongodb.com/blog/post/building-with-patterns-a-summary">Here is a link to learn more about them.</a> Here are some of the use cases of MongoDB design patterns</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/1__e997BZwNZlrMfOgY2X4HUw.png" alt=""></p>
<p><a href="https://www.linkedin.com/in/nirjalpaudel/">You can follow me on LinkedIn, as I like to rant about technologies over there.</a></p>
<p><a href="https://www.linkedin.com/in/nirjalpaudel/">https://www.linkedin.com/in/nirjalpaudel/</a></p>
<p>MongoDB pattern has its pros and cons and at the end of the day, proper usage of patterns is preventing you a call at 2am in the morning saying that DB is down but on the other hand you will miss the over time pay from your company, so choose wisely extra üí∞ or üõå.</p>
<p><em>Thank you for reading until the end. Please consider following the writer and this publication. Visit</em> <a href="https://stackademic.com/"><strong><em>Stackademic</em></strong></a> <em>to find out more about how we are democratizing free programming education around the world.</em></p>
</section>

  
  

  
  
  
  
  

  
  

  
  

  


  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="http://localhost:1313/">My New Hugo Site</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by HugoÔ∏èÔ∏è</a
  >Ô∏è
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >‚úé Paper</a
  >
</footer>

  </body>
</html>
