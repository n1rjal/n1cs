<!doctype html>































<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="en-us"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Overloading TypeScript Constructors like C&#43;&#43; or Java with a Catch - My New Hugo Site</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="Whenever I was looking into the TypeScript Date class constructor implementation, I always wondered how its constructor signature worked like that, how it can have many signature, how can it work with 1st argument as number or string or an instance of itself. Every time I tried to implement the constructor signature in TypeScript using the documentation like TypeScript says I was getting type error shown below.
I was working on node-nepali-datetime open source package in github." />
  <meta name="author" content="My New Hugo Site" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://localhost:1313/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://localhost:1313/theme.png" />

  
  
  
  
  

  
  
  

  
  
  <script
    defer
    src="http://localhost:1313/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.126.1">

  
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://localhost:1313/"
      >My New Hugo Site</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Overloading TypeScript Constructors like C&#43;&#43; or Java with a Catch</h1>

    
  </header>

  <section><p>Whenever I was looking into the TypeScript Date class constructor implementation, I always wondered how its constructor signature worked like that, how it can have many signature, how can it work with 1st argument as number or string or an instance of itself. Every time I tried to implement the constructor signature in TypeScript using the documentation like TypeScript says I was getting type error shown below.</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/1__gSrFHn2__nTLUEDVZdI5QQw.png" alt=""></p>
<blockquote>
<p>I was working on <a href="https://github.com/opensource-nepal/node-nepali-datetime"><strong>node-nepali-datetime</strong></a> open source package in github.You might be thinking now that this is reinventing the wheel. The reason is that Nepal is around 60 years into the future. The first month of Nepalse calender, the <strong>Bikram Sambat calender</strong>, is Baisakh. It falls somewhere around April and has other similar features like the English (A.D) calender.</p>
</blockquote>
<p>But whenever I looked into typescript implementation for date. I could see something that there were 5 different overload for date.</p>
<p><img src="/Users/nirjalpaudel/Downloads/me/posts/md_1717232175977/img/1__ECDFLU6d4P6CGrbV6CzEDQ.jpeg" alt=""></p>
<p>In the fifth constructor implementation, I obeserved that the <a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html">typescript doc string</a> can be the reason behind this implementation then I tried putting doc string in places.</p>
<pre><code>/\*\*  
 \* Creates NepaliDate instance from current date  
 \* @example new Date()  
 \*/  
constructor()  

/\*\*  
 \* Create NepaliDate instance from provided english date  
 \*  
 \* @param {Date} date  
 \*  
 \* @example  
 \* const nepaliDate = new NepaliDate( new Date('2020-01-01') )  
 \*  
 \*/  
constructor(date: Date)  

/\*\*  
 \* Create NepaliDate instance from using a provided english date  
 \* @param {NepaliDate} date: nepali date value provided as a value.  
 \* @example  
 \* const nepaliDateOld = new NepaliDate('2080-01-01')  
 \* const nepaliDate = new NepaliDate( nepaliDateOld )  
 \*  
 \*/  
constructor(date: NepaliDate)  

/\*\*  
 \* Create NepaliDate instance by parsing a provided string value  
 \* @param {string} value: string date time.  
 \* @example  
 \* const nepaliDate = new NepaliDate('2080-01-01')  
 \*  
 \*/  
constructor(value: string)  

/\*\*  
 \* Create NepaliDate instance by parsing a provided numeric value  
 \* @param {number} value: numeric value  
 \* @example  
 \* const n = new NepaliDate(new Date(373314600000))  
 \*  
 \*/  
constructor(value: number)  

/\*\*  
 \* Create NepaliDate instance by parsing a provided time string with format provided  
 \* @param dateString: string date time  
 \* @param format: string format of the date provided  
 \* @example  
 \* const n1 = new NepaliDate('2042/08/12 14-05-23.789', 'YYYY/MM/DD HH-mm-ss.SSS')  
 \*  
 \*/  
constructor(dateString: string, format: string)  

/\*\*  
 \* Creates a new instance of the Date class.  
 \*  
 \* @constructor  
 \* @param {number} year - The year.  
 \* @param {number} month - The month (0-11, where 0 is January and 11 is December).  
 \* @param {number=} day - The day of the month (1-31).  
 \* @param {number=} hour - The hour of the day (0-23).  
 \* @param {number=} minute - The minute (0-59).  
 \* @param {number=} second - The second (0-59).  
 \* @param {number=} ms - The milliseconds (0-999).  
 \*  
 \* @example  
 \* const \[year, month, day\] = \[2080, 1, 12\]  
 \* const hour = 12  
 \* const minute = 30  
 \* const second = 45  
 \* const ms = 500  
 \* const nd = new NepaliDate(year, month, day, hour, minute, second, ms)  
 \*/  
constructor(        year: number,  
    month: number,  
    day?: number,  
    hour?: number,  
    minute?: number,  
    second?: number,  
    ms?: number    ) {}
</code></pre>
<p>Unforunately, the same type trouble still persisted, I tried looking into various ways of generalizing many overloads into a final constructor. Before my PR, the project had the following implementation</p>
<p>constructor(&hellip;args: any[]) {<br>
if (args.length === 0) {<br>
this._setDateObject(new Date())<br>
} else if (args.length === 1) {<br>
const e = args[0]<br>
if (typeof e === &lsquo;object&rsquo;) {<br>
if (e instanceof Date) {<br>
this._setDateObject(e)<br>
} else if (e instanceof NepaliDate) {<br>
this.timestamp = e.timestamp<br>
this.year = e.year<br>
this.yearEn = e.yearEn<br>
this.month = e.month<br>
this.monthEn = e.monthEn<br>
this.day = e.day<br>
this.dayEn = e.dayEn<br>
this.hour = e.hour<br>
this.minute = e.minute<br>
this.weekDay = e.weekDay<br>
} else {<br>
throw new Error(&lsquo;Invalid date argument&rsquo;)<br>
}<br>
} else if (typeof e === &rsquo;number&rsquo;) {<br>
this._setDateObject(new Date(e))<br>
} else if (typeof e === &lsquo;string&rsquo;) {<br>
// Try to parse the date<br>
this.set.apply(this, parse(e))<br>
} else {<br>
throw new Error(&lsquo;Invalid date argument&rsquo;)<br>
}<br>
} else if (<br>
args.length === 2 &amp;&amp;<br>
typeof args[0] === &lsquo;string&rsquo; &amp;&amp;<br>
typeof args[1] === &lsquo;string&rsquo;<br>
) {<br>
const [dateTimeString, format] = args<br>
this.set.apply(this, parseFormat(dateTimeString, format))<br>
} else {<br>
this.set(<br>
args[0], // year<br>
args[1], // month<br>
args[2] ?? 1, // day<br>
args[3] ?? 0, // hour<br>
args[4] ?? 0, // minute<br>
args[5] ?? 0, // second<br>
args[6] ?? 0 // ms<br>
)<br>
}<br>
}</p>
<p>The above implemention is almost perfect but, then friendly neighbour hood <strong>eslint</strong> yelled about using any. I even considered making an exception to the rule using the following.</p>
<p>@typescript-eslint/no-explicit-any</p>
<p>But this is an open source project and I was not bound by time limit or pressured to delievered fast and no one was depending on me for this. So, I decided to dive more deep into working of typescript and constructor.</p>
<p>Luckily, javascript has an awesome feature called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments%5C"><strong>arguments</strong></a><strong>.</strong> I tried to look into it to find out if it could be more helpful. This is how arguments work. I was a bit skeptical that it would throw a type error like other implementation but to my suprise it didn‚Äôt raise any type error in the editor.</p>
<p>function func1(a, b, c) {<br>
console.log(arguments)<br>
// Excepted output: 1, 2, 3</p>
<p>console.log(arguments[0]);<br>
// Expected output: 1</p>
<p>console.log(arguments[1]);<br>
// Expected output: 2</p>
<p>console.log(arguments[2]);<br>
// Expected output: 3<br>
}</p>
<p>func1(1, 2, 3);</p>
<p>The final constructor code looks something like this. No type errors are thrown and the code supports all the types correclty. After adding some typescript doc string. This code was good to go for me. <strong>But there is a catch.</strong></p>
<pre><code>constructor()  
constructor(date: Date)  
constructor(date: NepaliDate)  
constructor(value: string)  
constructor(value: number)  
constructor(dateString: string, format: string)  
constructor(        year: number,  
    month: number,  
    day?: number,  
    hour?: number,  
    minute?: number,  
    second?: number,  
    ms?: number    )  
constructor() {  
    if (arguments.length === 0) {  
        this.\_setDateObject(new Date())  
    } else if (arguments.length === 1) {  
        const e = arguments\[0\]  
        if (typeof e === 'object') {  
            if (e instanceof Date) {  
                this.\_setDateObject(e)  
            } else if (e instanceof NepaliDate) {  
                this.timestamp = e.timestamp  
                this.year = e.year  
                this.yearEn = e.yearEn  
                this.month = e.month  
                this.monthEn = e.monthEn  
                this.day = e.day  
                this.dayEn = e.dayEn  
                this.hour = e.hour  
                this.minute = e.minute  
                this.weekDay = e.weekDay  
            } else {  
                throw new Error('Invalid date argument')  
            }  
        } else if (typeof e === 'number') {  
            this.\_setDateObject(new Date(e))  
        } else if (typeof e === 'string') {  
            // Try to parse the date  
            this.set.apply(this, parse(e))  
        } else {  
            throw new Error('Invalid date argument')  
        }  
    } else if (  
        arguments.length === 2 &amp;&amp;  
        typeof arguments\[0\] === 'string' &amp;&amp;  
        typeof arguments\[1\] === 'string'  
    ) {  
        const \[dateTimeString, format\] = arguments  
        this.set.apply(this, parseFormat(dateTimeString, format))  
    } else {  
        this.set(  
            arguments\[0\], // year  
            arguments\[1\], // month  
            arguments\[2\] ?? 1, // day  
            arguments\[3\] ?? 0, // hour  
            arguments\[4\] ?? 0, // minute  
            arguments\[5\] ?? 0, // second  
            arguments\[6\] ?? 0 // ms  
        )  
    }  
}
</code></pre>
<p>The catch is that in the actual implemenation of the code where things gets executed, the types information is completely lost resulting in code that checks for every single possible combination of values among the many implemenation using <strong>typeof, instanceof and arguments.length</strong> combination. The <strong>Date</strong> code in the javascript is native C++ code, so it was not such helpful for me. But with proper doc string added this code from user prespective is close to the native Date constructor implementation as I can go.</p>
<p>I took this design descision and I think this really works for now, but if you have any suggestion on why this peice of code sucks or is not good. Let me know. I like to write about technology and programming in linkedin. So, lets get connected there. Here are my socials.</p>
<p><a href="https://www.linkedin.com/in/nirjalpaudel/">https://www.linkedin.com/in/nirjalpaudel/</a></p>
<p><a href="https://github.com/n1rjal/" title="https://github.com/n1rjal/"><strong>n1rjal - Overview</strong><br>
_Curious about Tech | Nodejs ü©µ | Database üî•¬†. n1rjal has 83 repositories available. Follow their code on GitHub._github.com</a><a href="https://github.com/n1rjal/"></a></p>
<h3 id="in-plainenglish">In Plain¬†English</h3>
<p><em>Thank you for being a part of our community! Before you go:</em></p>
<ul>
<li><em>Be sure to</em> <strong><em>clap</em></strong> <em>and</em> <strong><em>follow</em></strong> <em>the writer! üëè</em></li>
<li><em>You can find even more content at</em> <a href="https://plainenglish.io/"><strong><em>PlainEnglish.io</em></strong></a> <strong><em>üöÄ</em></strong></li>
<li><em>Sign up for our</em> <a href="http://newsletter.plainenglish.io/"><strong><em>free weekly newsletter</em></strong></a><em>. üóûÔ∏è</em></li>
<li><em>Follow us on</em> <a href="https://twitter.com/inPlainEngHQ"><strong><em>Twitter</em></strong></a><strong><em>(X</em></strong>), <a href="https://www.linkedin.com/company/inplainenglish/"><strong><em>LinkedIn</em></strong></a>, <a href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw"><strong><em>YouTube</em></strong></a>, and <a href="https://discord.gg/XxRS92b2"><strong><em>Discord</em></strong></a><strong><em>.</em></strong></li>
</ul>
</section>

  
  

  
  
  
  
  

  
  

  
  

  


  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="http://localhost:1313/">My New Hugo Site</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by HugoÔ∏èÔ∏è</a
  >Ô∏è
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >‚úé Paper</a
  >
</footer>

  </body>
</html>
